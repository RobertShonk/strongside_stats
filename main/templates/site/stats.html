{% extends 'base.html' %}

{% block title %}Player Stats{% endblock %}

{% block nav_search %}
    <form class="nav_search" action="{{ url_for('site.stats') }}" method="get">
        <input type="text" id="summoner_name" name="summoner_name" placeholder="Summoner name" required>
        <input type="text" id="tagline" name="tagline" placeholder="NA1" required>
        <input type="submit" value="Enter">
    </form>
{% endblock %}

{% block content %}
    <div class="player_card">
        <div class="player_card_info">
            <div id="player_text">
                <h2>{{ session['summoner_name'] }}</h2>
                {% if leagues|length > 0 %}
                    <p>Lv: {{ leagues[0]['summonerLevel'] }}</p>
                {% endif %}
            </div>
            
            {% if leagues|length > 0 %}
                {% set filename = '/riot_assets/profileIcon/' + leagues[0]['profileIconId']|string + '.png' %}
                <div id="icon">
                    <img class="profile_icon" src="{{ url_for('static', filename=filename) }}" alt="profileIcon">
                </div>
            {% endif %}
            
        </div>
        {% if leagues|length > 0 %}
                <div class="solo_duo">
                    {% for league in leagues %}
                        {% if league['queueType'] == 'RANKED_SOLO_5x5' %}
                            <h3>Solo/Duo</h3>
                            <p>{{ league['tier'] }} {{ league['rank'] }} - {{ league['leaguePoints'] }} LP</p>
                        {% endif %}
                    {% endfor %}
                        
                </div>
                <div class="ranked_flex">
                    {% for league in leagues %}
                        {% if league['queueType'] == 'RANKED_FLEX_SR' %}
                            <h3>Flex</h3>
                            <p>{{ league['tier'] }} {{ league['rank'] }} - {{ league['leaguePoints'] }} LP</p>
                        {% endif %}
                    {% endfor %}
                </div>
        {% else %}
            <p>We don't have this player's ranked data. Try updating or make sure they have played their placement matches.</p>
        {% endif %}

        <form class="stats_update" action="{{ url_for('site.stats') }}" method="post">
            <input type="text" name="summoner_name" value="{{ session['summoner_name'] }}" hidden>
            <input type="text" name="tagline" value="{{ session['tagline'] }}" hidden>
            <input type="submit" value="Update">
        </form>
    </div>
    

    <div class="matches">
        {% for i in range(metadata|length) %}
            <div class="match">
                <div class="match_metadata">
                    {{ metadata[i]['gameMode'] }}<br>
                    {{ metadata[i]['gameCreation']|date }}<br>
                    {{ metadata[i]['gameDuration'] }}
                </div>
                {% for j in range(participants[i]|length) %}
                    {% if participants[i][j]['riotIdGameName'].lower() == session['summoner_name'].lower() %}
                        <div class="match_playerdata">
                            <div class="top_playerdata">
                                <div class="champ_icon">
                                    {% set champName = '/riot_assets/champion/' + participants[i][j]['championName'] + '.png' %}
                                    <img id="champ_icon" src="{{ url_for('static', filename=champName) }}">
                                </div>
                                <div class="summoner_spells">
                                    <p>{{ participants[i][j]['summoner1Id'] }}</p>
                                    <p>{{ participants[i][j]['summoner2Id'] }}</p>
                                </div>
                                <div class="runes">
                                    <p>{{ participants[i][j]['primary_main_rune'] }}</p>
                                    <p>{{ participants[i][j]['secondary_main_rune'] }}</p>
                                </div>
                                <div class="stats">
                                    <p>{{ participants[i][j]['kills'] }} / {{ participants[i][j]['deaths'] }} / {{ participants[i][j]['assists'] }}</p>
                                    {% if not participants[i][j]['deaths'] == 0 %}
                                        <p>{{ ((participants[i][j]['kills'] + participants[i][j]['assists']) / participants[i][j]['deaths'])|round(1) }}</p>
                                    {% else %}
                                        <p>Perfect</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="bot_playerdata">
                                <div class="items">
                                    {% set item0 = '/riot_assets/item/' + participants[i][j]['item0']|string + '.png' %}
                                    {% set item1 = '/riot_assets/item/' + participants[i][j]['item1']|string + '.png' %}
                                    {% set item2 = '/riot_assets/item/' + participants[i][j]['item2']|string + '.png' %}
                                    {% set item3 = '/riot_assets/item/' + participants[i][j]['item3']|string + '.png' %}
                                    {% set item4 = '/riot_assets/item/' + participants[i][j]['item4']|string + '.png' %}
                                    {% set item5 = '/riot_assets/item/' + participants[i][j]['item5']|string + '.png' %}
                                    <img class="item_icons" src="{{ url_for('static', filename=item0) }}">
                                    <img class="item_icons" src="{{ url_for('static', filename=item1) }}">
                                    <img class="item_icons" src="{{ url_for('static', filename=item2) }}">
                                    <img class="item_icons" src="{{ url_for('static', filename=item3) }}">
                                    <img class="item_icons" src="{{ url_for('static', filename=item4) }}">
                                    <img class="item_icons" src="{{ url_for('static', filename=item5) }}">
                                </div>
                            </div>       
                        </div>
                    {% endif %}
                {% endfor %}

                <div class="match_teams">
                    <div class="team1">
                        <img src="">{{ participants[i][0]['riotIdGameName'] }}<br>
                        {{ participants[i][1]['riotIdGameName'] }}<br>
                        {{ participants[i][2]['riotIdGameName'] }}<br>
                        {{ participants[i][3]['riotIdGameName'] }}<br>
                        {{ participants[i][4]['riotIdGameName'] }}
                    </div>
                    <div class="team2">
                        {{ participants[i][5]['riotIdGameName'] }}<br>
                        {{ participants[i][6]['riotIdGameName'] }}<br>
                        {{ participants[i][7]['riotIdGameName'] }}<br>
                        {{ participants[i][8]['riotIdGameName'] }}<br>
                        {{ participants[i][9]['riotIdGameName'] }}
                    </div>
                    
                </div>
            </div>
        {% endfor %}
    </div>
    
{% endblock %}