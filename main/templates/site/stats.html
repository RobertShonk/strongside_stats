{% extends 'base.html' %}

{% block title %}Player Stats{% endblock %}

{% block nav_search %}
    <form class="nav_search" action="{{ url_for('site.stats') }}" method="get">
        <input type="text" id="summoner_name" name="summoner_name" placeholder="Summoner name" required>
        <input type="text" id="tagline" name="tagline" placeholder="NA1" required>
        <input type="submit" value="Enter">
    </form>
{% endblock %}

{% block content %}
    <div class="player_card">
        <div class="player_card_info">
            <div id="player_text">
                <h4>{{ session['summoner_name'] }}</h4>
                {% if leagues|length > 0 %}
                    <p>Lv: {{ leagues[0]['summonerLevel'] }}</p>
                {% endif %}
            </div>
            
            {% if leagues|length > 0 %}
                {% set filename = '/riot_assets/profileIcon/' + leagues[0]['profileIconId']|string + '.png' %}
                <div id="icon">
                    <img class="profile_icon" src="{{ url_for('static', filename=filename) }}" alt="profileIcon">
                </div>
            {% endif %}
            
        </div>
        {% if leagues|length > 0 %}
                <div class="solo_duo">
                    {% for league in leagues %}
                        {% if league['queueType'] == 'RANKED_SOLO_5x5' %}
                            <h3>Solo/Duo</h3>
                            <p>{{ league['tier'] }} {{ league['rank'] }} - {{ league['leaguePoints'] }} LP</p>
                        {% endif %}
                    {% endfor %}
                        
                </div>
                <div class="ranked_flex">
                    {% for league in leagues %}
                        {% if league['queueType'] == 'RANKED_FLEX_SR' %}
                            <h3>Flex</h3>
                            <p>{{ league['tier'] }} {{ league['rank'] }} - {{ league['leaguePoints'] }} LP</p>
                        {% endif %}
                    {% endfor %}
                </div>
        {% else %}
            <p>We don't have this player's ranked data. Try updating or make sure they have played their placement matches.</p>
        {% endif %}

        <form class="stats_update" action="{{ url_for('site.stats') }}" method="post">
            <input type="text" name="summoner_name" value="{{ session['summoner_name'] }}" hidden>
            <input type="text" name="tagline" value="{{ session['tagline'] }}" hidden>
            <input type="submit" value="Update">
        </form>
    </div>
    

    <div class="matches">
        {% for match in matches %}
            <div class="match">
                <div class="match_metadata">
                    {{ match['game_mode'] }}<br><br>
                    {{ match['game_creation'] }}<br><br>
                    {{ match['game_duration'] }}
                </div>

                <div class="match_playerdata">
                    <div class="top_playerdata">
                        <div class="champ_icon">
                            {% set champName = '/riot_assets/champion/' + match.player['championName'] + '.png' %}
                            <img id="champ_icon" src="{{ url_for('static', filename=champName) }}">
                        </div>
                        <div class="summoner_spells">
                            {% set summoner1 = '/riot_assets/summonerSpells/' + summoner_spells[match.player['summoner1Id']|string]|string + '.png' %}
                            {% set summoner2 = '/riot_assets/summonerSpells/' + summoner_spells[match.player['summoner2Id']|string]|string + '.png' %}
                            <img class="summoner_spell_icon" src="{{ url_for('static', filename=summoner1) }}"><br>
                            <img class="summoner_spell_icon" src="{{ url_for('static', filename=summoner2) }}">
                        </div>
                        <div class="runes">
                            {% set rune1 = '/riot_assets/' + runes['primary_runes'][match.player['primary_rune1']]['icon'] %}
                            {% set rune2 = '/riot_assets/' + runes['secondary_runes'][match.player['secondary_main_rune']]['icon'] %}
                            <img id="primary_rune" class="rune_icon" src="{{ url_for('static', filename=rune1) }}"><br>
                            <img id="secondary_rune" class="rune_icon" src="{{ url_for('static', filename=rune2) }}">
                        </div>
                        <div class="stats">
                            <p>{{ match.player['kills'] }}/{{ match.player['deaths'] }}/{{ match.player['assists'] }}</p>
                            <p>{{ match.get_kda_ratio() }}</p>
                        </div>
                    </div>
                    <div class="bot_playerdata">
                        <div class="items">
                            {% set item0 = '/riot_assets/item/' + match.player['item0']|string + '.png' %}
                            {% set item1 = '/riot_assets/item/' + match.player['item1']|string + '.png' %}
                            {% set item2 = '/riot_assets/item/' + match.player['item2']|string + '.png' %}
                            {% set item3 = '/riot_assets/item/' + match.player['item3']|string + '.png' %}
                            {% set item4 = '/riot_assets/item/' + match.player['item4']|string + '.png' %}
                            {% set item5 = '/riot_assets/item/' + match.player['item5']|string + '.png' %}
                            <img class="item_icons" src="{{ url_for('static', filename=item0) }}" alt="">
                            <img class="item_icons" src="{{ url_for('static', filename=item1) }}" alt="">
                            <img class="item_icons" src="{{ url_for('static', filename=item2) }}" alt="">
                            <img class="item_icons" src="{{ url_for('static', filename=item3) }}" alt="">
                            <img class="item_icons" src="{{ url_for('static', filename=item4) }}" alt="">
                            <img class="item_icons" src="{{ url_for('static', filename=item5) }}" alt="">
                        </div>
                    </div>       
                </div>

                <div class="extra_info">
                    <p>Damage Dealt: {{ match.player['totalDamageDealtToChampions']}}</p>
                    <p>Damage Taken: {{ match.player['totalDamageTaken'] }}</p>
                    <p>CS/min:</p>
                </div>
                <div class="match_teams">
                    <div class="team1">
                        {% set p0_icon = '/riot_assets/champion/' + match.participants[0]['championName'] + '.png' %}
                        {% set p1_icon = '/riot_assets/champion/' + match.participants[1]['championName'] + '.png' %}
                        {% set p2_icon = '/riot_assets/champion/' + match.participants[2]['championName'] + '.png' %}
                        {% set p3_icon = '/riot_assets/champion/' + match.participants[3]['championName'] + '.png' %}
                        {% set p4_icon = '/riot_assets/champion/' + match.participants[4]['championName'] + '.png' %}
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p0_icon) }}">
                            <div class="team_player_name">{{ match.participants[0]['riotIdGameName'] }}</div>
                        </div>
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p1_icon) }}">
                            <div class="team_player_name">{{ match.participants[1]['riotIdGameName'] }}</div>
                        </div>
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p2_icon) }}">
                            <div class="team_player_name">{{ match.participants[2]['riotIdGameName'] }}</div>
                        </div>
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p3_icon) }}">
                            <div class="team_player_name">{{ match.participants[3]['riotIdGameName'] }}</div>
                        </div>
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p4_icon) }}">
                            <div class="team_player_name">{{ match.participants[4]['riotIdGameName'] }}</div>
                        </div>
                    </div>
                    <div class="team2">
                        {% set p5_icon = '/riot_assets/champion/' + match.participants[5]['championName'] + '.png' %}
                        {% set p6_icon = '/riot_assets/champion/' + match.participants[6]['championName'] + '.png' %}
                        {% set p7_icon = '/riot_assets/champion/' + match.participants[7]['championName'] + '.png' %}
                        {% set p8_icon = '/riot_assets/champion/' + match.participants[8]['championName'] + '.png' %}
                        {% set p9_icon = '/riot_assets/champion/' + match.participants[9]['championName'] + '.png' %}
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p5_icon) }}">
                            <div class="team_player_name">{{ match.participants[5]['riotIdGameName'] }}</div>
                        </div>
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p6_icon) }}">
                            <div class="team_player_name">{{ match.participants[6]['riotIdGameName'] }}</div>
                        </div>
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p7_icon) }}">
                            <div class="team_player_name">{{ match.participants[7]['riotIdGameName'] }}</div>
                        </div>
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p8_icon) }}">
                            <div class="team_player_name">{{ match.participants[8]['riotIdGameName'] }}</div>
                        </div>
                        <div class="team_player">
                            <img class="team_champ_icon" src="{{ url_for('static', filename=p9_icon) }}">
                            <div class="team_player_name">{{ match.participants[9]['riotIdGameName'] }}</div>
                        </div>
                    </div>
                    
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}